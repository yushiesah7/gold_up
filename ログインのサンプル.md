```py

"""MT5 login test script"""

from __future__ import annotations

import os
import sys
from pathlib import Path

from dotenv import load_dotenv


def main() -> None:
    """Main function to test MT5 login."""
    try:
        # Load environment variables first (.env → Numba → vectorbt)
        load_dotenv()

        # Add src directory to Python path (project imports below avoid E402 by being inside main)
        src_path = Path(__file__).parent / "src"
        if str(src_path) not in sys.path:
            sys.path.insert(0, str(src_path))

        # Local imports after sys.path and .env
        from mt5_trader.core.logger import get_logger, setup_logging  # noqa: E402
        from mt5_trader.domain.value_objects.mt5_credentials import (  # noqa: E402
            MT5Credentials,
        )
        from mt5_trader.infrastructure.adapters.mt5.mt5_adapter import (  # noqa: E402
            MT5Adapter,
            MT5ConnectionError,
        )

        # Setup logging
        setup_logging(reset_handlers=True, console_output=True, json_format=False)
        logger = get_logger(__name__)
        logger.info("mt5_login_test_starting")
        logger.info("environment_variables_loaded")

        # Create credentials from environment variables
        credentials = MT5Credentials.from_env_vars(
            account_str=os.getenv("MT5__ACCOUNT"),
            password=os.getenv("MT5__PASSWORD"),
            server=os.getenv("MT5__SERVER"),
        )
        logger.info("credentials_created", server=credentials.server)

        # Create MT5 adapter
        adapter = MT5Adapter(logger)

        # Attempt connection
        logger.info("connection_attempting")
        success = adapter.connect(
            credentials.account,
            credentials.password,
            credentials.server,
        )

        if success:
            logger.info("connection_successful")

            # Get and display account information
            account_info = adapter.get_account_info()
            if account_info:
                logger.info("account_info_retrieved", **account_info)
                print("\n✅ MT5接続成功!")
                print(f"アカウント: {account_info['login']}")
                print(f"名前: {account_info['name']}")
                print(f"サーバー: {account_info['server']}")
                print(f"残高: {account_info['balance']:.2f} {account_info['currency']}")
                print(
                    f"証拠金: {account_info['equity']:.2f} {account_info['currency']}"
                )
                print(f"レバレッジ: 1:{account_info['leverage']}")
                print(f"取引モード: {account_info['trade_mode']}")

            # Disconnect
            adapter.disconnect()
            logger.info("connection_closed")
            print("\n🔌 接続を正常に終了しました")

        else:
            logger.error("connection_failed")
            print("\n❌ MT5接続に失敗しました")
            sys.exit(1)

    except MT5ConnectionError as e:  # type: ignore[name-defined]
        # MT5ConnectionError は main 内 import のため type: ignore
        # ここでの except は接続系の既知エラーをハンドリング
        from mt5_trader.core.logger import get_logger  # noqa: E402

        logger = get_logger(__name__)
        logger.error("mt5_connection_error", error=str(e))
        print(f"\n❌ MT5接続エラー: {e}")
        sys.exit(1)

    except Exception as e:
        from mt5_trader.core.logger import get_logger  # noqa: E402

        logger = get_logger(__name__)
        logger.exception("unexpected_error", error=str(e))
        print(f"\n❌ 予期しないエラー: {e}")
        sys.exit(1)


if __name__ == "__main__":
    main()
```